/*! For license information please see extension.js.LICENSE.txt */
module.exports=(()=>{var e={702:function(e){var t;t=function(){"use strict";function e(e){return"function"==typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,r=void 0,o=void 0,s=function(e,t){h[n]=e,h[n+1]=t,2===(n+=2)&&(o?o(f):b())},i="undefined"!=typeof window?window:void 0,a=i||{},c=a.MutationObserver||a.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(f,1)}}var h=new Array(1e3);function f(){for(var e=0;e<n;e+=2)(0,h[e])(h[e+1]),h[e]=void 0,h[e+1]=void 0;n=0}var p,v,g,m,b=void 0;function y(e,t){var n=this,r=new this.constructor(x);void 0===r[_]&&M(r);var o=n._state;if(o){var i=arguments[o-1];s((function(){return A(o,r,i,n._result)}))}else C(n,r,e,t);return r}function w(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(x);return j(t,e),t}u?b=function(){return process.nextTick(f)}:c?(v=0,g=new c(f),m=document.createTextNode(""),g.observe(m,{characterData:!0}),b=function(){m.data=v=++v%2}):l?((p=new MessageChannel).port1.onmessage=f,b=function(){return p.port2.postMessage(0)}):b=void 0===i?function(){try{var e=Function("return this")().require("vertx");return void 0!==(r=e.runOnLoop||e.runOnContext)?function(){r(f)}:d()}catch(e){return d()}}():d();var _=Math.random().toString(36).substring(2);function x(){}var P=void 0;function k(t,n,r){n.constructor===t.constructor&&r===y&&n.constructor.resolve===w?function(e,t){1===t._state?E(e,t._result):2===t._state?D(e,t._result):C(t,void 0,(function(t){return j(e,t)}),(function(t){return D(e,t)}))}(t,n):void 0===r?E(t,n):e(r)?function(e,t,n){s((function(e){var r=!1,o=function(n,o,s,i){try{n.call(o,(function(n){r||(r=!0,t!==n?j(e,n):E(e,n))}),(function(t){r||(r=!0,D(e,t))}))}catch(e){return e}}(n,t,0,0,e._label);!r&&o&&(r=!0,D(e,o))}),e)}(t,n,r):E(t,n)}function j(e,t){if(e===t)D(e,new TypeError("You cannot resolve a promise with itself"));else if(o=typeof(r=t),null===r||"object"!==o&&"function"!==o)E(e,t);else{var n=void 0;try{n=t.then}catch(t){return void D(e,t)}k(e,t,n)}var r,o}function S(e){e._onerror&&e._onerror(e._result),T(e)}function E(e,t){e._state===P&&(e._result=t,e._state=1,0!==e._subscribers.length&&s(T,e))}function D(e,t){e._state===P&&(e._state=2,e._result=t,s(S,e))}function C(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+1]=n,o[i+2]=r,0===i&&e._state&&s(T,e)}function T(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,s=e._result,i=0;i<t.length;i+=3)r=t[i],o=t[i+n],r?A(n,r,o,s):o(s);e._subscribers.length=0}}function A(t,n,r,o){var s=e(r),i=void 0,a=void 0,c=!0;if(s){try{i=r(o)}catch(e){c=!1,a=e}if(n===i)return void D(n,new TypeError("A promises callback cannot return that same promise."))}else i=o;n._state!==P||(s&&c?j(n,i):!1===c?D(n,a):1===t?E(n,i):2===t&&D(n,i))}var q=0;function M(e){e[_]=q++,e._state=void 0,e._result=void 0,e._subscribers=[]}var O=function(){function e(e,n){this._instanceConstructor=e,this.promise=new e(x),this.promise[_]||M(this.promise),t(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?E(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&E(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===P&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===w){var o=void 0,s=void 0,i=!1;try{o=e.then}catch(e){i=!0,s=e}if(o===y&&e._state!==P)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===F){var a=new n(x);i?D(a,s):k(a,e,o),this._willSettleAt(a,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===P&&(this._remaining--,2===e?D(r,n):this._result[t]=n),0===this._remaining&&E(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;C(e,void 0,(function(e){return n._settledAt(1,t,e)}),(function(e){return n._settledAt(2,t,e)}))},e}(),F=function(){function t(e){this[_]=q++,this._result=this._state=void 0,this._subscribers=[],x!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){j(e,t)}),(function(t){D(e,t)}))}catch(t){D(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this,r=n.constructor;return e(t)?n.then((function(e){return r.resolve(t()).then((function(){return e}))}),(function(e){return r.resolve(t()).then((function(){throw e}))})):n.then(t,t)},t}();return F.prototype.then=y,F.all=function(e){return new O(this,e).promise},F.race=function(e){var n=this;return t(e)?new n((function(t,r){for(var o=e.length,s=0;s<o;s++)n.resolve(e[s]).then(t,r)})):new n((function(e,t){return t(new TypeError("You must pass an array to race."))}))},F.resolve=w,F.reject=function(e){var t=new this(x);return D(t,e),t},F._setScheduler=function(e){o=e},F._setAsap=function(e){s=e},F._asap=s,F.polyfill=function(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=F},F.Promise=F,F},e.exports=t()},111:(e,t,n)=>{"use strict";const r=n(622);e.exports=(e,t)=>{if("string"!=typeof e)throw new TypeError("Expected a string, got "+typeof e);let n=e;return(t=Object.assign({resolve:!0},t)).resolve&&(n=r.resolve(e)),n=n.replace(/\\/g,"/"),"/"!==n[0]&&(n="/"+n),encodeURI("file://"+n).replace(/[?#]/g,encodeURIComponent)}},426:e=>{e.exports.location="phantom\\bin\\phantomjs.exe",e.exports.platform="win32",e.exports.arch="x64"},975:(e,t,n)=>{var r=n(747),o=n(622),s=n(129).spawn;n(702).Promise;try{var i=n(426);t.ET=o.resolve(__dirname,i.location),i.platform,i.arch}catch(e){t.ET=null}if(t.ET)try{var a=r.statSync(t.ET),c=a.mode|parseInt("0555",8);c!==a.mode&&r.chmodSync(t.ET,c)}catch(e){}t.GL=function(){var e=Array.prototype.slice.call(arguments);return s(t.ET,e)}},117:e=>{var t=global.Promise;e.exports=function(e){return e&&(t=e),t}},789:(e,t,n)=>{var r=Array.prototype.slice,o=n(117),s=function(e){var t,n,r=new(o())((function(e,r){t=e,n=r})),s=e&&e.pattern,i=e&&e.noError;return{promise:r,callback:s?function(e){if(e&&!i)return n(e);var r,o={},a=i?0:1;for(r=0;r<s.length;r++)o[s[r]]=arguments[r+a];t(o)}:i?t:function(e,r){e?n(e):t(r)}}};e.exports=function(e,t,n,o){return o&&o.callbackIsFirstArg?function(n){if("function"==typeof n)return t.apply(e,arguments);var i=s(o),a=r.call(arguments,0);return a.unshift(i.callback),t.apply(e,a),i.promise}:function(){var i=arguments[arguments.length-1];if("function"==typeof i)return t.apply(e,arguments);for(var a=s(o),c=r.call(arguments,0);c.length<n;)c.push(void 0);c.push(a.callback);var u=t.apply(e,c);return o&&o.returnsObject?(Object.defineProperty(u,"promise",{value:a.promise}),u):a.promise}}},262:(e,t,n)=>{var r=n(129),o=n(789),s=function(e,t){return t&&t.bind(e)};Object.defineProperties(e.exports,{ChildProcess:{enumerable:!0,value:r.ChildProcess},exec:{enumerable:!0,value:o(r,r.exec,1,{pattern:["stdout","stderr"],returnsObject:!0})},execFile:{enumerable:!0,value:o(r,r.execFile,1,{pattern:["stdout","stderr"],returnsObject:!0})},execFileSync:{enumerable:!0,value:s(r,r.execFileSync)},execSync:{enumerable:!0,value:s(r,r.execSync)},fork:{enumerable:!0,value:s(r,r.fork)},spawn:{enumerable:!0,value:s(r,r.spawn)},spawnSync:{enumerable:!0,value:s(r,r.spawnSync)}})},326:(e,t,n)=>{"use strict";const r=n(622),o=n(111),s=n(262),i=n(975).ET,a=r.resolve(__dirname,"./converter.js"),c="data:image/png;base64,";function u(e={}){if(void 0!==e.filename&&void 0!==e.url)throw new Error("Cannot specify both filename and url options");return void 0!==e.filename&&delete(e=Object.assign({url:o(e.filename)},e)).filename,[a,JSON.stringify(e)]}function l(e){const t=e.stdout.toString();if(t.startsWith(c))return new Buffer(t.substring(c.length),"base64");if(t.length>0)throw new Error(t.replace(/\r/g,"").trim());const n=e.stderr.toString();if(n.length>0)throw new Error(n.replace(/\r/g,"").trim());throw new Error("No data received from the PhantomJS child process")}e.exports=(e,t)=>Promise.resolve().then((()=>{const n=s.execFile(i,u(t),{maxBuffer:1/0});return function(e,t){const n=t.toString("utf8");e.cork();for(let t=0;t<n.length;t+=1024)e.write(n.substring(t,t+1024));e.end()}(n.stdin,e),n.promise.then(l)})),e.exports.sync=(e,t)=>l(s.spawnSync(i,u(t),{input:e.toString("utf8")}))},112:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const r=n(549),o=n(908),s=n(473);var i;t.activate=function(e){s.default.info("Active!"),(i=new o.default(e)).present();const t=[r.commands.registerCommand("extension.showsequencediagrampreview",(()=>{i.present()}))];for(let n=0;n<t.length;n++)e.subscriptions.push(t[n])},t.deactivate=function(){}},473:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static info(e){"string"==typeof e?console.log(n.loggerPrefix+e):console.log(n.loggerPrefix,e)}static warn(e){console.warn(n.loggerPrefix+e)}static error(e){console.error(n.loggerPrefix+e)}}t.default=n,n.loggerPrefix="vscode-sequence-diagrams: "},908:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(549),s=n(89),i=n(473);class a{constructor(e){this.exContext=e,this.checkRefreshDocument=this.checkRefreshDocument.bind(this);var t=o.workspace.onDidChangeTextDocument(this.checkRefreshDocument),n=o.window.onDidChangeActiveTextEditor(this.checkRefreshDocument);this.exContext.subscriptions.push(t),this.exContext.subscriptions.push(n),this.previewTrigger=o.workspace.getConfiguration("sequencediagrams").get("preview.trigger","onChange")}present(){return r(this,void 0,void 0,(function*(){this.provider=new s.default(this.exContext),this.provider.diagramStyle=o.workspace.getConfiguration("sequencediagrams").get("diagram.style","simple"),this.provider.present(),this.checkRefreshDocument(o.window.activeTextEditor)}))}checkRefreshDocument(e){void 0!==e&&void 0!==o.window.activeTextEditor&&null!=e.document&&!e.document.isClosed&&e.document===o.window.activeTextEditor.document&&a.isDocumentDiagram(e.document)?"onSave"===this.previewTrigger&&e.document.isDirty?i.default.info("Check refresh document rejected - trigger configured to OnSave."):(i.default.info("Check refresh document accepted."),this.provider.refreshDocument(e.document)):i.default.info("Check refresh document rejected.")}static isDocumentDiagram(e){return"sequencediagram"===e.languageId}}t.default=a},89:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(549),s=n(326),i=n(593),a=n(473),c=n(747),u=n(622);t.default=class{constructor(e){this.extensionPath=e.extensionPath,this._receiveMessage=this._receiveMessage.bind(this),this._refreshDocument=this._refreshDocument.bind(this),this._getExportFileName=this._getExportFileName.bind(this),this.currentPanel=o.window.createWebviewPanel("sequence-diagram","Sequence Diagram",o.ViewColumn.Two,{enableScripts:!0,enableCommandUris:!1,localResourceRoots:[o.Uri.file(u.join(e.extensionPath,"src"))]}),this.currentPanel.webview.onDidReceiveMessage(this._receiveMessage,void 0,e.subscriptions),this.currentPanel.onDidDispose((()=>{this.currentPanel=void 0}),void 0,e.subscriptions),this.throttledRefreshDocument=i.throttle(this._refreshDocument,200)}_receiveMessage(e){return r(this,void 0,void 0,(function*(){if(null==e||null==e.command)return;let t;try{let n;switch(e.command){case"export-svg":t="svg",n=this._getExportFileName(t),c.writeFileSync(n,Buffer.from(e.data,"base64").toString("binary"));break;case"export-png":t="png",n=this._getExportFileName(t);const r=yield s(Buffer.from(e.data,"base64"));c.writeFileSync(n,r)}o.window.showInformationMessage("Sequence Diagrams - "+t.toUpperCase()+" saved to "+n)}catch(e){a.default.error(e),o.window.showErrorMessage("Sequence Diagrams - Failed to save "+t.toUpperCase())}this.currentPanel.webview.postMessage({command:"export-done"})}))}_getExportFileName(e){const t=this.previewDocument.fileName;return(t.substr(0,t.lastIndexOf("."))||t)+"."+e}present(){this.setWebViewContent()}refreshDocument(e){this.previewDocument=e,this.throttledRefreshDocument()}_refreshDocument(){this.currentPanel.webview.postMessage({command:"set-source",source:this.previewDocument.getText()})}setWebViewContent(){null!=this.currentPanel&&(this.currentPanel.webview.html=this.createContent())}createContent(){return`\n            <html>\n                <link href='${this.assetPath("deps/js-sequence-diagrams/sequence-diagram.css")}' rel='stylesheet' />\n                <style>\n            body { margin: 0; }\n\n            .status-panel {\n                background-color: rgba(128, 128, 128, 0.1);\n                padding: 4px;\n                position: fixed;\n                bottom: 0;\n                left: 0;\n                right: 0;\n                text-align: right;\n            }\n\n            .export-btn {\n                cursor: pointer;\n                border: 1px solid #aaa;\n                padding: 4px 8px;\n                color: #333333;\n                display: inline-block;\n            }\n            body.vscode-dark .export-btn {\n                color: #dedede;\n            }\n\n            .export-btn.disabled {\n                cursor: default;\n                background-color: rgba(128, 128, 128, 0.1);\n                color: #666666;\n            }\n            body.vscode-dark .export-btn.disabled {\n                color: #aaaaaa;\n            }\n\n            body.vscode-dark svg line, svg path {\n                stroke: #ababab;\n            }\n\n            body.vscode-dark svg .signal line, body.vscode-dark svg .signal path,\n            body.vscode-dark svg .title rect, body.vscode-dark svg .title path,\n            body.vscode-dark svg .actor rect, body.vscode-dark svg .actor path,\n            body.vscode-dark svg .note rect, body.vscode-dark svg .note path {\n                fill: none;\n                stroke: #ababab;\n            }\n\n            body.vscode-dark svg .title text,\n            body.vscode-dark svg .signal text,\n            body.vscode-dark svg .note text,\n            body.vscode-dark svg .actor text {\n                fill: #dedede;\n            }</style>\n                <body>\n                    <div id="diagram"></div>\n                    <div class='status-panel'>\n                        <div class='export-btn link-download-svg'>Export SVG</div>\n                        <div class='export-btn link-download-png'>Export PNG</div>\n                    </div>\n                    <script>\n                        window.diagramStyle = "${this.diagramStyle}";\n                    <\/script>\n                    <script src="${this.assetPath("deps/js-sequence-diagrams/snap.svg-min.js")}"><\/script>\n                    <script src="${this.assetPath("deps/js-sequence-diagrams/underscore-min.js")}"><\/script>\n                    <script src="${this.assetPath("deps/js-sequence-diagrams/webfont.js")}"><\/script>\n                    <script src="${this.assetPath("deps/js-sequence-diagrams/sequence-diagram-snap-min.js")}"><\/script>\n                    <script src="${this.assetPath("contentscript.js")}"><\/script>\n                </body>\n            </html>`}assetPath(e){return this.currentPanel.webview.asWebviewUri(o.Uri.file(u.join(this.extensionPath,"src",e)))}}},593:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=void 0,t.throttle=function(e,t){var n,r,o,s,i=0,a=function(){i=(new Date).getTime(),n=null,s=e.apply(r,o),n||(r=o=null)};return function(){var c=(new Date).getTime(),u=t-(c-i);return r=this,o=arguments,u<=0||u>t?(n&&(clearTimeout(n),n=null),i=c,s=e.apply(r,o),n||(r=o=null)):n||(n=setTimeout(a,u)),s}}},129:e=>{"use strict";e.exports=require("child_process")},747:e=>{"use strict";e.exports=require("fs")},622:e=>{"use strict";e.exports=require("path")},549:e=>{"use strict";e.exports=require("vscode")}},t={};return function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}(112)})();
//# sourceMappingURL=extension.js.map